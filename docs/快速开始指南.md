# 快速开始指南

欢迎使用《星穹铁道剧情复现计划》！本指南将帮助你快速上手，体验 AI 驱动的互动剧情系统。

## 前置要求

1. **Node.js 20+** 和 **pnpm**
2. **DeepSeek API Key**（或其他兼容 OpenAI 的 LLM API）

## 第一步：环境配置

### 1. 安装依赖

```bash
pnpm install
```

### 2. 配置环境变量

复制 `.env.example` 为 `.env`：

```bash
cp .env.example .env
```

编辑 `.env` 文件，设置你的 API Key：

```env
# DeepSeek API（推荐，性价比高）
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# 或使用 OpenAI API
# OPENAI_API_KEY=your_openai_api_key_here
```

> 💡 **获取 DeepSeek API Key**：访问 [https://platform.deepseek.com/](https://platform.deepseek.com/) 注册并获取 API Key

### 3. 构建项目

```bash
pnpm build
```

## 第二步：创建示例会话

运行示例会话创建脚本：

```bash
pnpm tsx scripts/create-demo-session.ts
```

这将创建一个名为"贝洛伯格初遇"的示例会话，包含：

- 🏛️ 场景：贝洛伯格中央广场
- 👥 角色：三月七、星
- 📝 初始剧情：星穹列车刚抵达雅利洛-VI

## 第三步：开始游戏

### 方式 1：直接启动（推荐）

```bash
pnpm cli start
```

然后从列表中选择"贝洛伯格初遇"会话。

### 方式 2：指定会话 ID

```bash
pnpm cli start -c <session_id>
```

（会话 ID 在创建时会显示）

## 第四步：与角色互动

进入会话后，你可以：

### 对话型输入

与角色对话，格式：`对[角色名]说：[内容]`

```
对三月七说：你好，这里的风景真美！
对星说：我们去探索一下这座城市吧
```

### 指令型输入

让角色执行动作，格式：`让[角色名][动作]`

```
让三月七拍照
让星观察周围
让三月七和星一起探索广场
```

### 会话内命令

输入 `/help` 查看所有可用命令：

| 命令               | 说明                               |
| ------------------ | ---------------------------------- |
| `/help`            | 显示帮助信息                       |
| `/status`          | 显示当前状态（场景、回合、人物等） |
| `/characters`      | 显示人物列表和关系                 |
| `/events`          | 显示最近发生的事件                 |
| `/vision`          | 显示视野隔离状态（验证信息隔离）   |
| `/save`            | 手动保存会话                       |
| `/snapshot [描述]` | 创建快照（用于回溯）               |
| `/anchor`          | 锚点管理（创建/列出/删除）         |
| `/compare`         | 对比当前状态与锚点                 |
| `/quit`            | 退出会话                           |

## 示例互动流程

以下是一个完整的互动示例：

```
▶ /status
场景: belobog_plaza
回合: 0
人物数: 2
事件数: 2
信息数: 3
天气: snowy
时间: afternoon

▶ 对三月七说：这里好冷啊，不过雪景真的很美！

三月七：哇！是啊是啊！虽然很冷，但这种银装素裹的感觉真的太棒了！
  [三月七 拿出相机拍照]
  (三月七心想：一定要把这美丽的雪景记录下来！)

[状态变更]
  三月七 → 星: 亲密 60% ↑ 62%

▶ 让星观察广场中央的雕像

星：......
  [星 走近雕像，仔细观察]
  (星心想：这座雕像似乎有着特殊的意义)

▶ /vision
═══ 视野隔离状态 ═══

  三月七 (march7)
    已知信息: 3 条
      ✓ 贝洛伯格是一座被永冬笼罩的城市...
      ✓ 星穹列车刚刚抵达雅利洛-VI星球...
      ✓ 广场中央的雕像是贝洛伯格的守护者...

  星 (stelle)
    已知信息: 3 条
      ✓ 贝洛伯格是一座被永冬笼罩的城市...
      ✓ 星穹列车刚刚抵达雅利洛-VI星球...
      ✓ 广场中央的雕像是贝洛伯格的守护者...

▶ /snapshot 探索开始
快照已创建: snapshot_1234567890_abc123

▶ /quit
退出前是否保存？
> 保存并退出
会话已保存

再见！
```

## 核心功能体验

### 1. 视野隔离

系统会自动管理每个角色的已知信息。当某个信息只有部分角色知道时，其他角色不会泄露这些信息。

**测试方法**：

1. 让三月七单独发现某个秘密（例如：`让三月七独自探索广场东侧`）
2. 然后询问星关于这个秘密（例如：`对星说：你知道广场东侧有什么吗？`）
3. 星会表示不知道，因为她没有目睹这个信息

### 2. 关系演化

角色之间的关系会根据互动动态变化：

- **对话** → 增加亲密度
- **帮助** → 增加信任度
- **共同探索** → 增加亲密度和信任度
- **冲突** → 降低信任度，增加敌意
- **分享秘密** → 大幅增加亲密度和信任度

使用 `/characters` 命令查看当前关系状态。

### 3. 锚点与对比

创建锚点来标记重要的剧情节点，然后对比不同分支的差异：

```bash
# 创建锚点
/anchor create

# 继续推进剧情...

# 对比当前状态与锚点
/compare
```

系统会显示：

- 总体差异度
- 具体差异项（关系变化、能力变化等）
- 评估结果

### 4. 快照与回溯

随时创建快照，保存当前状态：

```bash
/snapshot 重要节点
```

如果想回到之前的状态，可以使用导出/导入功能：

```bash
# 导出当前会话
pnpm cli export <session_id> -o backup.json

# 导入会话（恢复到之前的状态）
pnpm cli import backup.json
```

## 进阶使用

### 创建自定义会话

你可以创建自己的会话，添加自定义角色和场景：

1. **添加角色配置**：在 `config/characters/` 目录下创建 YAML 文件
2. **添加场景配置**：在 `config/scenes/` 目录下创建 YAML 文件
3. **自定义触发规则**：编辑 `config/triggers/` 下的触发表

参考现有的配置文件：

- [config/characters/march7.yaml](config/characters/march7.yaml)
- [config/scenes/belobog_plaza.yaml](config/scenes/belobog_plaza.yaml)
- [config/triggers/relationship_triggers.yaml](config/triggers/relationship_triggers.yaml)

### 命令行工具

除了交互式会话，还可以使用命令行工具：

```bash
# 列出所有会话
pnpm cli session list

# 查看会话详情
pnpm cli session info <session_id>

# 删除会话
pnpm cli session delete <session_id>

# 导出会话
pnpm cli export <session_id> -o output.json

# 导入会话
pnpm cli import input.json

# 查看配置
pnpm cli config show
```

## 常见问题

### Q: 角色响应很慢？

A: 这取决于你使用的 LLM API。DeepSeek 通常响应较快。如果使用 OpenAI，可以考虑切换到 `gpt-3.5-turbo` 以提高速度。

### Q: 看到 DeprecationWarning 警告？

A: 这是某些依赖包使用了已弃用的 `punycode` 模块导致的，不影响功能。项目已配置 `--no-deprecation` 标志来隐藏这些警告。如果仍然看到警告，可以安全忽略。

### Q: 如何让角色说话更符合原作？

A: 编辑角色配置文件中的 `behaviorConfig.speakingStyle` 和 `catchphrases`，添加更多角色特征。

### Q: 视野隔离不生效？

A: 使用 `/vision` 命令检查每个角色的已知信息。确保信息归属正确设置（witnessed/heard/told）。

### Q: 关系值没有变化？

A: 检查触发表配置是否正确加载。使用 `/events` 查看事件是否正确记录。

### Q: 如何重置会话？

A: 删除会话后重新创建：

```bash
pnpm cli session delete <session_id>
pnpm demo
```

## 下一步

- 📖 阅读 [技术文档](docs/技术栈总结.md) 了解系统架构
- 🔧 查看 [WBS 任务分解表](docs/WBS任务分解表.md) 了解功能模块
- 🚀 查看 [优化计划](docs/优化计划.md) 了解后续开发方向
- 💡 参与开发：查看 [CLAUDE.md](CLAUDE.md) 了解开发规范

## 获取帮助

- 查看项目文档：`docs/` 目录
- 查看模块文档：`docs/modules/` 目录
- 提交 Issue：[GitHub Issues](https://github.com/your-repo/issues)

---

祝你玩得开心！🎮✨
