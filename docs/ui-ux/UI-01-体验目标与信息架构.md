# UI-01 体验目标与信息架构（MVP）

**文档版本**：v1.0
**创建日期**：2026-02-04
**状态**：待评审
**对应里程碑**：M2 - UI/UX 方案冻结（Phase 1 范围）

---

## 一、文档目标

本文档定义 Phase 1 MVP 的用户体验目标与信息架构，为后续 UI 绘制工具（Figma/Sketch 等）提供明确的输入。

**产出内容**：
1. MVP 用户路径（端到端流程）
2. 信息架构（页面/模块层级关系）
3. 页面清单与核心功能
4. 关键交互点与容错策略

---

## 二、Phase 1 MVP 体验目标

### 2.1 核心体验目标

| 目标 | 说明 | 验收标准 |
|------|------|----------|
| **视野隔离可验证** | 用户能清晰感知不同角色的信息不对称；角色 B 不会泄露仅角色 A 所知的信息 | 1 场景 + 2 角色下，某信息仅 A 知时，B 的回复不包含该信息 |
| **剧情推进可控** | 用户通过文字输入驱动剧情，系统解析意图并反馈角色行为与状态变化 | 指令型/对话型输入能正确解析并驱动一轮剧情 |
| **导出/导入可用** | 用户能导出人物/场景配置，并在新会话中导入复用 | 人物/场景 JSON 导出包可成功导入并在新会话中加载 |
| **对比结果可见** | 用户能对比当前分支与原剧情锚点，查看人物状态与视野的差异 | 单节点对比可输出差异说明（人物状态 + 视野） |

### 2.2 非目标（Phase 1 不做）

- 多角色复杂协同（Phase 2）
- 主题一致性评估（Phase 3）
- 可视化状态图表（Phase 3）
- Web 界面（Phase 1 使用 CLI）

---

## 三、MVP 用户路径（端到端流程）

### 3.1 主流程：剧情推进与对比

```
用户启动 → 新建/加载会话 → 配置场景与角色 → 输入指令/对话 → 查看角色反应与状态变化
→ （可选）创建快照 → （可选）对比原剧情锚点 → （可选）导出人物/场景 → 结束会话
```

### 3.2 详细用户路径

#### 路径 1：新建会话并推进剧情

1. **启动应用**（CLI）
   - 用户执行 `npm start` 或 `node cli.js`
   - 系统显示欢迎信息与主菜单

2. **新建会话**
   - 用户选择「新建会话」
   - 系统提示输入会话名称（如 `雅利洛-贝洛伯格初遇`）
   - 系统创建会话 ID 并初始化空白世界状态

3. **配置场景与角色**
   - 用户选择「加载场景」→ 选择场景 ID（如 `scene_belobog_plaza`）
   - 用户选择「加载角色」→ 选择角色 ID（如 `character_march7`, `character_stelle`）
   - 系统加载场景配置与角色人设，显示当前场景描述与在场角色列表

4. **输入指令/对话**
   - 用户输入文字（如 `三月七，你看到什么了？` 或 `让星去开门`）
   - 系统解析输入类型（对话型/指令型）
   - 系统显示解析结果（如 `[对话型] 目标角色：三月七`）

5. **查看角色反应与状态变化**
   - 系统调用角色 Agent，基于该角色当前状态与视野生成回复
   - 系统显示角色对话（如 `三月七：「我看到一座巨大的雕像，好像是城市的守护者！」`）
   - 系统显示状态变化摘要（如 `三月七获得信息：贝洛伯格雕像`）

6. **继续推进或退出**
   - 用户可继续输入，或选择「创建快照」「对比锚点」「导出」「退出」

#### 路径 2：导出与导入

1. **导出人物/场景**
   - 用户在会话中选择「导出」→ 选择导出对象（人物/场景）
   - 系统提示选择导出类型（人物模板/状态快照）
   - 系统生成 JSON 文件并保存到 `exports/` 目录
   - 系统显示导出成功与文件路径

2. **导入人物/场景**
   - 用户在新会话中选择「导入」→ 选择导入文件
   - 系统检查 ID 冲突与依赖缺失
   - 若有冲突，系统提示用户选择策略（覆盖/重命名/终止）
   - 系统导入成功并显示导入对象列表

#### 路径 3：对比原剧情锚点

1. **创建快照**
   - 用户在关键节点选择「创建快照」
   - 系统保存当前世界状态、人物状态、视野信息
   - 系统显示快照 ID 与时间戳

2. **对比锚点**
   - 用户选择「对比锚点」→ 选择锚点 ID（如 `anchor_belobog_first_meet`）
   - 系统加载锚点数据与当前分支状态
   - 系统计算差异并显示对比报告：
     - 人物状态差异（关系/能力/修养/性格）
     - 人物视野差异（已知信息对比）
     - 差异说明列表（如 `三月七知晓了原作未接触的信息：xxx`）

---

## 四、信息架构

### 4.1 页面/模块层级关系

```
应用根
├── 主菜单（会话管理）
│   ├── 新建会话
│   ├── 加载会话
│   ├── 会话列表
│   └── 退出
│
├── 会话工作区（剧情推进）
│   ├── 场景信息区
│   │   ├── 场景描述
│   │   ├── 在场角色列表
│   │   └── 环境状态摘要
│   │
│   ├── 剧情展示区
│   │   ├── 对话历史（时间线）
│   │   ├── 事件记录
│   │   └── 状态变化提示
│   │
│   ├── 用户输入区
│   │   ├── 文字输入框
│   │   ├── 输入类型提示（解析结果）
│   │   └── 快捷指令按钮（可选）
│   │
│   ├── 人物状态面板（最小）
│   │   ├── 角色列表
│   │   ├── 当前关系（简化显示）
│   │   ├── 已知信息列表（视野）
│   │   └── 能力/修养/性格（简化显示）
│   │
│   └── 操作菜单
│       ├── 创建快照
│       ├── 对比锚点
│       ├── 导出/导入
│       └── 返回主菜单
│
├── 对比结果页
│   ├── 对比摘要（总评）
│   ├── 人物状态对比
│   │   ├── 关系差异
│   │   ├── 能力差异
│   │   ├── 修养/性格差异
│   │   └── 视野差异（已知信息对比）
│   ├── 差异说明列表
│   └── 返回/导出报告
│
└── 导出/导入对话框
    ├── 导出
    │   ├── 选择对象（人物/场景）
    │   ├── 选择类型（模板/快照）
    │   └── 确认导出
    │
    └── 导入
        ├── 选择文件
        ├── 冲突检查结果
        ├── 冲突处理策略选择
        └── 确认导入
```

### 4.2 信息流向

```
用户输入 → Input Parser（解析） → Story Orchestrator（编排）
    ↓
World Engine（更新环境/情节） + Vision Manager（更新视野） + Character State（更新状态）
    ↓
Character Agent（生成对话/行动，基于过滤后视野）
    ↓
剧情展示区（显示对话与状态变化） + 人物状态面板（更新显示）
```

---

## 五、页面清单与核心功能

### 5.1 主菜单（会话管理）

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 新建会话 | 创建新会话，输入会话名称 | P0 |
| 加载会话 | 从会话列表中选择已有会话 | P0 |
| 会话列表 | 显示所有会话（名称、创建时间、最后修改时间） | P0 |
| 删除会话 | 删除选中会话（需确认） | P1 |
| 退出 | 退出应用 | P0 |

### 5.2 会话工作区（剧情推进）

#### 5.2.1 场景信息区

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 场景描述 | 显示当前场景名称与环境描述 | P0 |
| 在场角色列表 | 显示当前场景中的角色（名称 + 头像/图标） | P0 |
| 环境状态摘要 | 显示物理/社会/氛围状态（简化文本） | P1 |

#### 5.2.2 剧情展示区

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 对话历史 | 按时间线显示用户输入与角色回复（带时间戳） | P0 |
| 事件记录 | 显示关键事件（如「三月七获得信息：xxx」） | P0 |
| 状态变化提示 | 显示人物状态变化（如「三月七对星的信任 +10」） | P1 |
| 滚动与翻页 | 支持历史记录滚动查看 | P0 |

#### 5.2.3 用户输入区

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 文字输入框 | 多行文本输入，支持回车提交 | P0 |
| 输入类型提示 | 显示解析结果（如「[对话型] 目标角色：三月七」） | P0 |
| 快捷指令按钮 | 可选：常用指令按钮（如「创建快照」「查看状态」） | P2 |
| 输入历史 | 支持上下键查看历史输入（可选） | P2 |

#### 5.2.4 人物状态面板（最小）

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 角色列表 | 显示在场角色，点击查看详情 | P0 |
| 当前关系 | 显示该角色与其他角色的关系（简化：如「信任：80」） | P0 |
| 已知信息列表 | 显示该角色当前已知的信息 ID 与摘要 | P0 |
| 能力/修养/性格 | 显示关键维度数值（简化：如「战斗：65」） | P1 |
| 状态历史 | 可选：查看该角色的状态变化历史 | P2 |

#### 5.2.5 操作菜单

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 创建快照 | 保存当前世界状态与人物状态 | P0 |
| 对比锚点 | 选择锚点并查看对比结果 | P0 |
| 导出/导入 | 打开导出/导入对话框 | P0 |
| 加载场景/角色 | 在当前会话中加载新场景或角色 | P0 |
| 返回主菜单 | 保存会话并返回主菜单 | P0 |

### 5.3 对比结果页

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 对比摘要 | 显示总评（如「贴合度：75%」） | P1 |
| 人物状态对比 | 分维度显示差异（关系/能力/修养/性格/视野） | P0 |
| 差异说明列表 | 列出具体差异点（如「三月七知晓了原作未接触的信息：xxx」） | P0 |
| 导出报告 | 将对比结果导出为文本/JSON 文件 | P1 |
| 返回 | 返回会话工作区 | P0 |

### 5.4 导出/导入对话框

#### 5.4.1 导出

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 选择对象 | 选择导出对象（人物/场景/全部） | P0 |
| 选择类型 | 人物：选择「模板」或「状态快照」 | P0 |
| 文件名输入 | 输入导出文件名（默认：对象名 + 时间戳） | P0 |
| 确认导出 | 生成 JSON 文件并保存到 `exports/` 目录 | P0 |
| 导出成功提示 | 显示文件路径与成功信息 | P0 |

#### 5.4.2 导入

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 选择文件 | 浏览并选择导入文件（JSON） | P0 |
| 冲突检查 | 自动检查 ID 冲突与依赖缺失 | P0 |
| 冲突处理策略 | 若有冲突，提示用户选择：覆盖/重命名/终止 | P0 |
| 依赖缺失提示 | 若有依赖缺失，提示用户补充导入或创建占位 | P1 |
| 确认导入 | 执行导入并显示导入对象列表 | P0 |
| 导入成功/失败提示 | 显示导入结果与失败项列表（如有） | P0 |

---

## 六、关键交互点与容错策略

### 6.1 输入解析与容错

| 场景 | 交互点 | 容错策略 | 优先级 |
|------|--------|----------|--------|
| 模糊输入 | 用户输入不明确（如「去那边」） | 反问澄清（如「你想让谁去哪里？」）或提示「无法解析，请明确目标角色与动作」 | P0 |
| 越权请求 | 用户输入超出权限（如「让星核猎手立刻变成友方」） | 拒绝并提示「超出权限：无法直接修改角色阵营」 | P0 |
| 无意义输入 | 用户输入乱码或无意义文本 | 提示「无法解析，请输入有效指令或对话」 | P0 |
| 目标角色不在场 | 用户指令目标角色不在当前场景 | 提示「角色 xxx 不在当前场景」 | P0 |

### 6.2 剧情推进与异常

| 场景 | 交互点 | 容错策略 | 优先级 |
|------|--------|----------|--------|
| 无推进路径 | 当前场景无可用交互或分支 | 提示「当前无推进路径，请调整输入或加载新场景」 | P1 |
| Agent 调用失败 | LLM API 调用超时或失败 | 提示「角色 xxx 暂时无法回应，请稍后重试」 | P0 |
| 状态更新失败 | 状态写入失败（如文件系统错误） | 提示「状态保存失败，请检查存储空间」并回滚到上一状态 | P0 |

### 6.3 导出/导入与冲突

| 场景 | 交互点 | 容错策略 | 优先级 |
|------|--------|----------|--------|
| ID 冲突 | 导入时发现同 ID 对象已存在 | 提示用户选择：覆盖/重命名/终止 | P0 |
| 依赖缺失 | 导入对象依赖的资源不存在（如角色所属势力） | 提示用户补充导入或创建占位默认值 | P1 |
| 文件格式错误 | 导入文件格式不正确或损坏 | 提示「文件格式错误，请检查文件」并终止导入 | P0 |
| 版本不兼容 | 导入包版本与当前引擎版本不兼容 | 提示「版本不兼容，需要引擎版本 >= xxx」并终止导入 | P1 |

### 6.4 对比与锚点

| 场景 | 交互点 | 容错策略 | 优先级 |
|------|--------|----------|--------|
| 锚点缺失 | 选择的锚点不存在或未加载 | 提示「锚点 xxx 不存在，请检查锚点 ID」 | P0 |
| 状态不匹配 | 当前分支与锚点的场景/角色不匹配 | 提示「当前分支与锚点场景不匹配，对比结果可能不准确」 | P1 |
| 对比计算失败 | 对比模块计算失败 | 提示「对比计算失败，请稍后重试」 | P0 |

---

## 七、Phase 1 CLI 实现建议

### 7.1 CLI 技术栈（参考技术选型）

- **命令解析**：Commander.js
- **交互式输入**：Inquirer.js
- **彩色输出**：Chalk
- **加载动画**：Ora
- **表格显示**：cli-table3（可选）

### 7.2 CLI 界面示例

#### 主菜单

```
╔════════════════════════════════════════════════════════════╗
║  星穹铁道剧情复现计划 - Star Rail Story Replication Plan  ║
╚════════════════════════════════════════════════════════════╝

请选择操作：
  1. 新建会话
  2. 加载会话
  3. 会话列表
  4. 退出

>
```

#### 会话工作区

```
╔════════════════════════════════════════════════════════════╗
║  会话：雅利洛-贝洛伯格初遇                                  ║
║  场景：贝洛伯格广场 | 在场角色：三月七, 星                  ║
╚════════════════════════════════════════════════════════════╝

[对话历史]
[10:23:15] 用户: 三月七，你看到什么了？
[10:23:18] 三月七: 「我看到一座巨大的雕像，好像是城市的守护者！」
[10:23:18] 系统: 三月七获得信息：贝洛伯格雕像

[用户输入]
> 让星去调查雕像

[解析结果] [指令型] 目标角色：星 | 动作：调查 | 对象：雕像

[操作菜单]
  1. 继续输入
  2. 创建快照
  3. 对比锚点
  4. 查看人物状态
  5. 导出/导入
  6. 返回主菜单

>
```

#### 对比结果页

```
╔════════════════════════════════════════════════════════════╗
║  对比结果：当前分支 vs 锚点 [anchor_belobog_first_meet]    ║
╚════════════════════════════════════════════════════════════╝

[对比摘要]
总评：75% 贴合度

[人物状态对比 - 三月七]
  关系（对星）：当前 80 | 锚点 75 | 差异 +5
  能力（战斗）：当前 65 | 锚点 65 | 差异 0
  视野（已知信息）：当前 5 条 | 锚点 4 条 | 差异 +1

[差异说明]
  ⚠ 三月七知晓了原作未接触的信息：贝洛伯格地下城入口
  ✓ 三月七对星的信任度略高于原作（+5）

[操作]
  1. 导出报告
  2. 返回会话

>
```

---

## 八、后续工作（UI-02 至 UI-05）

本文档完成后，后续 UI 绘制工具（Figma/Sketch）应基于本文档进行：

1. **UI-02 关键页面线框稿**：绘制主菜单、会话工作区、对比结果页、导出/导入对话框的线框稿
2. **UI-03 交互稿**：补充交互说明（模糊输入提示、越权拒绝提示、无推进路径提示、导入冲突提示）
3. **UI-04 视觉稿与组件规范**：基于 Material Design 3 规范，绘制视觉稿与组件规范（按钮/列表/弹窗/状态条）
4. **UI-05 UI 评审与冻结**：评审并冻结 MVP UI 方案

---

## 九、验收标准

本文档（UI-01）的验收标准：

- [x] 明确 MVP 用户路径：新建会话→输入→推进→快照→对比→导出/导入
- [x] 信息架构清晰：页面/模块层级关系明确
- [x] 页面清单完整：覆盖主菜单、会话工作区、对比结果页、导出/导入对话框
- [x] 关键交互点与容错策略明确：输入解析、剧情推进、导出/导入、对比锚点
- [x] 为 UI 绘制工具提供明确输入：页面结构、功能列表、交互流程

---

## 十、附录

### 10.1 参考文档

- [需求文档-星穹铁道剧情复现计划.md](../需求文档-星穹铁道剧情复现计划.md)
- [概要设计.md](../概要设计.md)
- [WBS任务分解表.md](../WBS任务分解表.md)
- [技术选型与架构设计.md](../技术选型与架构设计.md)
- [项目进度表.md](../项目进度表.md)

### 10.2 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.0 | 2026-02-04 | 初始版本 | Claude Sonnet 4.5 |
