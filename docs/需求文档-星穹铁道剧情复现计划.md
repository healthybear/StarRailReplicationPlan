# 《星穹铁道剧情复现计划》需求文档

## 一、项目概述

### 1.1 项目名称

星穹铁道剧情复现计划（Star Rail Story Replication Plan）

### 1.2 项目目标

在可控的「剧情沙盒」中，用 Agent 驱动每个角色，在给定背景、环境、势力、道具等设定下推进剧情；用户通过自然语言输入影响剧情走向，系统根据角色行为逻辑做出反应，并支持与原版剧情中的人物反应对比，用于评估 Agent 控制下的人物是否贴合原作。**人物、星球、场景等均支持导出与复用，便于将同一人物或道具放入不同剧情线中使用。**

### 1.3 设计框架：小说四要素

本需求以**小说四要素**为骨架展开：**人物、环境、情节、主题**。四者均为可配置、可演化、可导出复用的对象，共同支撑剧情复现与用户改写。

- **人物**：动态实体，关系、能力、修养、性格、行为模型随剧情演化；**人物视觉**：不同人物接收的信息与视野不同，对同一事件的判断也不同，Agent 仅能基于该人物当前所知信息与主观判断行动（见 2.1、2.2）。
- **环境**：动态设定，物理/社会/氛围随剧情变化，可导出并在不同剧情中复用（见 2.3）。
- **情节**：由事件链与关键节点构成，随人物行为与用户输入演化，支持结构导出与对比（见 2.4）。
- **主题**：剧情所传达的核心立意，可配置、可检验，用于评估复现与改写是否「贴合原意」（见 2.5）。

### 1.4 核心价值

- **剧情可交互**：用户通过文字参与并改变剧情走向。
- **角色一致性检验**：用原剧情反应作为基准，评估 Agent 人设贴合度。
- **四要素联动**：人物、环境、情节、主题均非静态，随剧情发展而演化，并可分别导出与对比。
- **可复用、可移植**：人物、星球、场景、道具、情节线、主题设定等可导出，并在不同剧情中复用，支撑后续「跨剧情编排」需求。

---

## 二、需求详述

### 2.1 角色 Agent 与行为逻辑（人物为动态实体）

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| 角色 Agent 抽象 | 每个可交互角色对应一个 Agent，具备独立的状态、目标、关系、记忆；**人物不是静态的，其状态随剧情推进而演化。** | P0 |
| 行为逻辑配置 | 支持为人设、说话风格、决策倾向等编写或配置逻辑；**逻辑可依赖当前「能力 / 修养 / 性格 / 关系」等动态状态，而非仅依赖初始设定。** | P0 |
| **关系随剧情演化** | 与其他人物的关系（信任、敌对、亲密度、立场等）随剧情事件、对话、选择而更新；支持关系变化对后续对话与行为的影响。 | P0 |
| **能力随剧情演化** | 人物的能力（战斗、技能、知识、权限等）可随剧情获得、失去或改变（如觉醒、受伤、学习），并影响可选行动与剧情分支。 | P0 |
| **修养随剧情演化** | 人物的修养（道德观、价值观、阅历、心境等）可随经历的事件与选择而渐变，并影响其态度、台词与重大抉择。 | P1 |
| **性格随剧情演化** | 性格可在长线剧情中发生合理演变（如从封闭到开放、从怀疑到信任），有显式状态或权重，并参与行为与对话生成。 | P1 |
| **行为模型随剧情演化** | Agent 的行为模型（策略、偏好、习惯）可根据「当前关系 / 能力 / 修养 / 性格」及近期经历做更新或微调，使行为与人物当前状态一致。 | P1 |
| 对话与行动 | Agent 根据**当前**剧情状态、**当前**人物状态（含关系/能力/修养/性格）、用户输入、其他角色行为，生成对话与行动。 | P0 |
| **人物视觉/视野** | 不同人物**接收的信息不同、视野（所知范围）不同**；Agent 仅能基于**该人物当前所知信息**生成对话与行动，不能使用「该人物未接触的信息」（信息不对称）。 | P0 |
| **对事件的判断差异** | 同一事件可由不同人物做出**不同判断**（基于各自视野、性格、立场）；Agent 的行为与台词应体现该人物的**主观判断**，而非「上帝视角」的统一结论。 | P0 |
| 多角色协同 | 多角色在场时，Agent 间可产生对话、冲突或合作；**关系与状态的变化在多方互动中同步更新**；**各方仅能基于自身视野做出反应，可产生误解、隐瞒或信息差驱动的冲突。** | P1 |

### 2.2 人物状态演化机制

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| **状态维度** | 人物至少包含可演化的维度：**关系**（与他人）、**能力**、**修养**、**性格**、**行为模型**（或等价参数）、**视野/已知信息**（该人物当前所知的事件、情报、传闻等）；各维度有可读写、可持久化的表示。 | P0 |
| **视野随剧情演化** | 人物的「已知信息」随**目睹、听闻、被告知、推理**等而更新；谁在何时何地获得哪条信息需可追溯，以便行为仅基于该人物当前视野，避免「不该知道的秘密」泄露。 | P0 |
| **演化驱动力** | 上述状态的变化由剧情事件、用户输入、与其他角色的互动、关键选择等驱动；重要节点需记录「谁 / 什么事件 / 导致哪项状态如何变化」。 | P0 |
| **演化约束** | 演化需符合设定边界（如能力不无理由暴涨、性格变化有铺垫），可配置合理性规则或审核点，避免 OOC。 | P1 |
| **状态对行为的影响** | 对话生成、选项生成、行为决策均读取**当前**关系/能力/修养/性格/**视野**，而非仅读取初始人设；**行为仅能基于该人物当前所知信息与主观判断**，不能使用全局上帝视角。 | P0 |
| **状态快照与回溯** | 支持在关键节点保存人物状态快照（含关系/能力/修养/性格/**视野/已知信息**等），便于对比「原剧情该节点的人物状态」与「Agent 控制下的状态」，也便于读档与分支对比。 | P1 |

### 2.3 环境（拓展）

环境是剧情发生的场所与氛围，**不是静态布景**，其状态随剧情、人物行为与用户输入而变化，并可导出、复用到不同剧情中。

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| **环境维度** | 环境至少包含：**物理环境**（场景、星球、时间线、天气、设施状态如破坏/修复）、**社会环境**（势力控制、舆论、规则、NPC 态度）、**氛围**（紧张/平和、危机等级、主题相关意象）。各维度可读写、可持久化。 | P0 |
| **环境随剧情演化** | 场景状态、势力分布、氛围等随剧情事件、人物选择、用户输入而更新（如某地被占领、某设施被毁、某势力态度转变）；演化结果影响后续可选行动与对话。 | P0 |
| **环境对人物与情节的影响** | Agent 行为与情节推进可读取**当前**环境状态（如「当前场景已损坏」影响对话与选项）；关键情节点可依赖环境条件触发。 | P0 |
| **环境快照与导出** | 支持在关键节点保存环境状态快照；星球/场景/势力均支持导出（含初始状态与可选「某节点状态」），便于跨剧情复用与对比。 | P1 |

### 2.4 情节（拓展）

情节是事件在时间与因果上的组织，**不是固定剧本**，随人物行为与用户输入而分支、演化，并有结构化的表示便于对比与复用。

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| **情节结构** | 支持情节的显式结构：**事件链**（已发生事件序列）、**关键节点**（分支点、高潮、结局）、**因果与伏笔**（某事件导致后续条件或回收）；可与原版剧情节点对齐，便于对比。 | P0 |
| **情节随互动演化** | 情节由用户输入、多 Agent 行为、环境变化共同推进；分支与结局非预先写死，而是根据当前人物状态、环境状态与选择动态生成或收敛。 | P0 |
| **情节与人物/环境的联动** | 关键情节点可依赖人物状态（如能力、关系）与环境状态（如势力、场景）作为触发条件；情节结果可反写人物状态与环境状态（因果闭环）。 | P0 |
| **情节线导出与复用** | 支持将「某条剧情线」或「某段情节结构」导出（节点列表、分支、依赖的人物/场景/主题 ID）；可在新剧情中复用情节骨架并替换人物/环境。 | P1 |

### 2.5 主题（拓展）

主题是剧情所要传达的核心立意（如命运、自由、羁绊、成长），**可配置、可检验**，用于约束或评估复现与改写是否「贴合原意」。

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| **主题定义** | 支持为剧情或剧情线配置**主题**（如关键词、核心命题、价值倾向）；主题可关联到关键节点或关键选择（「该节点体现主题 X」）。 | P1 |
| **主题在剧情中的体现** | 人物选择、情节走向、环境象征可被标记或推断为「体现某主题」；Agent 行为与情节生成可受主题约束（如避免明显违背既定主题的选项）。 | P1 |
| **主题一致性评估** | 在对比原剧情时，除人物状态与情节节点外，可评估**主题一致性**：用户改写后的剧情是否仍传达原主题，或合理延伸/收敛到新主题。 | P2 |
| **主题导出与复用** | 主题设定可随剧情线或世界观导出，在新剧情中复用或调整，便于「同主题不同故事」的编排。 | P2 |

### 2.6 世界与剧情基础（与四要素的衔接）

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| 背景设定 | 支持加载/编辑世界观、时代、地点、重大事件等背景文档，供 Agent 与剧情引擎使用；可与**环境、主题**绑定。 | P0 |
| 环境 | 场景（如空间站、雅利洛、仙舟等）、时间线、当前「场景状态」可配置与切换；详见 **2.3 环境**。 | P0 |
| 势力与关系 | 定义势力（星穹列车、星核猎手、公司等）及势力间、角色间关系，影响 Agent 的立场与选择；属于**环境**中的社会环境维度。 | P0 |
| 道具与物品 | 支持道具/关键物品的加载与状态（归属、是否已使用等），可触发特定剧情或限制/解锁行为；可与**环境、情节**联动。 | P1 |
| 剧情节点与分支 | 支持将原版剧情拆成节点与分支，便于「复现路线」与「用户改写路线」的对比；属于**情节**结构，见 **2.4 情节**。 | P1 |

### 2.7 剧情推进与用户控制

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| 用户输入 | 用户通过**文字输入**表达意图（如指令、对话、旁白式描述），系统解析后影响世界状态与角色行为。 | P0 |
| 剧情推进 | 根据用户输入 + 多 Agent 行为 + 当前环境/势力/道具，推进时间线与剧情状态。 | P0 |
| 状态持久化 | 关键状态（场景、角色状态、道具、关系、已发生事件）可保存与加载，支持「读档」与对比不同分支。 | P1 |

### 2.8 与原剧情的对比与评估

对比维度覆盖**小说四要素**：人物、环境、情节、主题。

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| 原剧情锚点 | 对关键节点保存「原版剧情」中的人物反应（对话、选择、态度）、**各人物在该节点的所知信息与对事件的判断**、**环境状态**、**情节走向**、**主题体现**，作为基准。 | P0 |
| 对比维度 | 在相同或相似情境下，对比 Agent 的回应与原版在：语气、立场、信息量、关键选择上是否一致。 | P0 |
| **人物状态对比** | 在关键节点，除对比对话与选择外，可对比**人物状态**：关系、能力、修养、性格等是否与原剧情在该节点的设定或表现一致，以判断 Agent 控制下的人物是否贴合且演化合理。 | P1 |
| **人物视野与判断对比** | 在关键节点，可对比 Agent 控制下的人物的**所知信息**与**对事件的判断**是否与原剧情中该人物的视角一致（如是否出现「不该知道的秘密」、判断是否与性格/视野/立场相符），以检验人物视觉与信息不对称是否落实。 | P1 |
| **环境状态对比** | 在关键节点，可对比**环境状态**：场景、势力、氛围等是否与原剧情在该节点的设定或表现一致，以判断环境演化是否合理。 | P1 |
| **情节走向对比** | 在关键节点或结局，可对比**情节走向**：事件链、分支选择、因果与伏笔是否与原剧情一致或合理延伸，以判断情节复现/改写的贴合度。 | P1 |
| **主题一致性对比** | 可评估**主题**：用户改写后的剧情是否仍传达原主题，或合理延伸/收敛到新主题，以判断「立意」是否贴合原意。 | P2 |
| 贴合度评估 | 提供定性/定量方式（人物/环境/情节/主题多维度）判断 Agent 控制下的剧情是否贴合原设与原意。 | P1 |
| 报告与复盘 | 支持导出对比结果或简单报告，便于迭代人设、环境、情节与主题设定。 | P2 |

---

## 三、导出与跨剧情复用

### 3.1 导出范围与格式

| 导出对象 | 说明 | 建议导出内容 | 优先级 |
|----------|------|--------------|--------|
| **人物** | 单个或多个角色的完整设定与行为逻辑 | 人设描述、说话风格、关系网片段、行为规则/配置、关键记忆模板、与势力/道具的绑定关系（可选）；**视野/已知信息**可随状态快照导出；**支持导出「人物模板」或「人物状态快照」**（见 3.3）。 | P0 |
| **星球/地图** | 以星球或大地图为单位的世界设定 | 星球名称、时代、地点列表、环境描述、势力分布、可用的场景 ID 列表。 | P0 |
| **场景** | 具体发生剧情的场景（如某节车厢、某城市广场） | 场景 ID、名称、所属星球/地图、环境状态、可放置的 NPC/道具槽位、进入/离开条件。 | P0 |
| **势力** | 组织、阵营 | 势力名称、成员列表（角色 ID）、与其他势力的关系、通用行为倾向。 | P1 |
| **道具/关键物品** | 可影响剧情或角色行为的物品 | 道具 ID、名称、效果描述、使用条件、所属剧情/场景（可选）。 | P1 |
| **剧情线/剧本片段** | 某条剧情线或一段剧本（**情节**结构） | 节点列表、分支、原剧情锚点、依赖的人物/场景/道具 ID；可选包含**情节**关键节点与因果链。 | P1 |
| **主题设定** | 剧情或剧情线所传达的核心立意 | 主题关键词、核心命题、关联的关键节点或选择 ID；可与剧情线一起导出。 | P2 |

**格式建议**：

- 采用结构化、可版本管理的格式（如 JSON / YAML）便于程序读写和 diff。
- 同时支持「人类可读」的导出（如 Markdown 摘要），便于审阅与二次编辑。
- 导出包内建议包含元数据：版本号、导出时间、依赖的其他资源 ID，便于后续导入时做兼容性检查。

### 3.2 导入与复用

| 需求项 | 描述 | 优先级 |
|--------|------|--------|
| 按 ID 引用 | 人物、场景、道具、星球等均有稳定 ID，剧情配置通过 ID 引用，避免硬编码名称。 | P0 |
| 导入人物到新剧情 | 将已导出的人物包导入到另一条剧情线中，可覆盖或补充该剧情中同 ID 角色的设定；**支持导入「人物模板」（从零演化）或「人物状态快照」（从该状态继续）。** | P0 |
| 导入场景/星球到新剧情 | 将已导出的场景或星球包导入，在新剧情中复用同一场景或同一星球的不同场景。 | P0 |
| 导入道具到新剧情 | 将道具定义导入新剧情，可在新剧情中挂接到不同角色或场景。 | P1 |
| 导入情节线/主题到新剧情 | 将已导出的剧情线或主题设定导入新剧情，可复用情节骨架或主题约束，并替换人物/环境。 | P2 |
| 依赖与冲突检查 | 导入时检查缺失的依赖（如角色所属势力、场景所属星球、情节依赖的人物/场景）及 ID 冲突，并给出提示或自动修复建议。 | P1 |

### 3.3 人物导出的两种含义

| 导出类型 | 说明 | 用途 |
|----------|------|------|
| **人物模板 / 基础包** | 导出人物的**初始**人设、初始关系、初始能力/修养/性格及行为逻辑配置；不包含某条剧情中的演化历史。 | 在新剧情中作为「空白起点」或统一起点复用。 |
| **人物状态快照 / 剧情节点包** | 导出在**某剧情、某节点**下的完整状态：当前关系、能力、修养、性格、行为模型参数、**当前视野/已知信息**及可选的历史演化记录。 | 复现「该节点时的角色」、对比原剧情、或将「已成长后的角色」导入另一条剧情。 |

**跨剧情复用的两种方式**：

- 可将「人物模板」导入新剧情，在新剧情中从零开始演化。
- 也可将「某剧情某节点的人物状态快照」导入另一条剧情，作为该角色的**当前状态**继续发展（实现「把经历过某段剧情后的角色放到另一条线」）。

**人物/道具「放入不同剧情」的支撑设计**：

- **人物**：人物配置与「当前剧情」解耦；行为逻辑、口吻、关系偏好等以「人物包」形式存在，剧情只引用人物 ID 并可选覆盖部分属性（如在该剧情中的初始关系、是否失忆）。支持同一人物在不同剧情中拥有不同初始状态或记忆片段，而不改人物基础人设。
- **道具**：道具定义与具体剧情解耦；效果、使用条件在「道具包」中定义，剧情中只声明「本剧情中出现的道具 ID 及初始归属」。同一道具可出现在多条剧情中，归属不同角色或场景。
- **场景/星球**：场景与星球以「世界包」形式导出，剧情通过「场景 ID 列表」声明本剧情会用到哪些场景，并可对同一场景在不同剧情中赋予不同初始状态（如是否被破坏、是否有某道具）。

---

## 四、系统角色与边界

- **用户**：通过文字参与剧情、触发角色反应、查看对比结果；可导出/导入人物、星球、场景、情节线、主题设定等资源。
- **剧情/世界引擎**：维护**环境**（场景、势力、氛围）、**情节**（事件链、节点、分支）、**主题**设定；负责导入/导出时的解析与校验；支持人物状态与环境状态的持久化与快照。
- **角色 Agent**：根据自身逻辑与**当前**状态（关系/能力/修养/性格/**视野/已知信息**）及**当前环境**生成对话与行动；**仅能基于该人物当前所知信息与主观判断**，不能使用上帝视角；其人设与行为逻辑来自「人物包」，状态随剧情演化。
- **对比/评估模块**：拉取原剧情锚点与当前分支反应，执行**人物 / 环境 / 情节 / 主题**多维度对比，输出贴合度评估。

---

## 五、非功能需求

- **可扩展**：新增角色、星球、场景、势力、道具、情节线、主题时，尽量通过配置/数据驱动。
- **可复现**：相同初始状态与用户输入序列可复现相同剧情走向（随机处可配置种子）。
- **可移植**：人物、环境（星球/场景/势力）、情节线、主题设定、道具均支持导出与导入，且格式稳定、带版本与依赖信息。
- **四要素状态可追溯**：关键节点的人物状态、环境状态、情节走向、主题体现可记录与回溯，便于对比与调试。
- **性能**：单轮响应时间控制在可接受范围内，便于实时交互。

---

## 六、方案评价与风险

### 6.1 优点

- **目标清晰**：复现 + 可交互 + 可对比，既有玩法又有验证价值。
- **四要素完整**：人物、环境、情节、主题均有显式建模与演化，更贴近小说叙事结构。
- **人物动态**：关系、能力、修养、性格、行为模型、**视野/已知信息**随剧情演化；**人物视觉**保证不同人物信息不对称、对事件判断不同，更贴近真实叙事。**环境、情节、主题**亦可随剧情变化或约束剧情，形成闭环。
- **对比机制**：用原剧情当「标尺」，人物/环境/情节/主题多维度对比，能直接指导 Agent、环境与情节逻辑的迭代。
- **模块划分清楚**：人物层、环境层、情节层、主题层、用户层、评估层、导出/导入层易于分阶段实现。
- **支持跨剧情复用**：人物、环境、情节线、主题、道具均可导出并在不同剧情中使用，支撑后续扩展。

### 6.2 风险与应对

| 风险 | 应对思路 |
|------|----------|
| 原剧情标注工作量大 | 先做少量关键节点与关键角色，再逐步扩充；可考虑半自动从剧本/录屏中抽取。 |
| Agent 行为不可控或 OOC | 用原剧情片段做 few-shot 或微调，强化「贴合原设」的奖励或约束；演化约束与合理性规则可配置。 |
| 用户输入意图复杂 | 先支持简单指令与明确对话，再逐步支持旁白、模糊意图与多轮澄清。 |
| 多 Agent 协调与状态同步复杂 | 先做单角色或双人场景，再扩展到多人同场与长线剧情；关系与状态变化在互动中显式更新。 |
| 人物状态演化难以控制 | 明确状态维度与演化驱动力，用状态快照做对比与回滚；演化约束避免无铺垫的突变。 |
| 人物视野/信息不对称难以落实 | 显式维护每人「已知信息」集合，行为与对话生成前过滤全局状态，仅注入该人物视野；用「人物视野与判断对比」检验是否出现泄密或上帝视角。 |
| 导出格式迭代导致旧包不兼容 | 导出包带版本号与最小引擎版本要求，导入时做版本校验并给出升级或迁移指引。 |
| 环境/情节/主题 的建模与对比复杂 | 先做环境状态与情节结构的简化表示（如关键节点 + 状态快照），主题先做关键词级配置；再逐步细化多维度对比与约束。 |

---

## 七、建议实施阶段

1. **Phase 1**：单场景 + 1～2 个核心角色 Agent + 简单世界状态；用户文字驱动；单节点原剧情对比；**人物、环境（场景/星球）具备稳定 ID 与最小化导出结构（如 JSON）**；**人物具备关系/能力/修养/性格/视野等可演化状态维度，并在行为中仅读取该人物当前状态与所知信息（人物视觉）**；**环境具备物理/社会/氛围等可演化维度，并在情节推进中读写。**
2. **Phase 2**：多角色、势力与关系、道具与剧情节点/分支、状态存档与读档；**人物状态（含视野/已知信息）与环境状态随剧情演化与快照**；**情节结构（事件链、关键节点、分支）显式建模并与人物/环境联动**；**完整实现人物/环境/场景/星球的导出与导入，支持人物模板与状态快照两种导出，支持将人物或道具放入另一条剧情**；**人物视野与判断对比**检验信息不对称是否落实。
3. **Phase 3**：**主题定义与主题一致性评估**；贴合度量化（含人物/环境/情节/主题多维度对比）、报告导出、更多场景与角色扩展；**势力、情节线、主题级别的导出与复用**；演化约束与合理性规则完善。
