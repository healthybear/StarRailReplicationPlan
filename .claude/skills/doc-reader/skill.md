---
name: doc-reader
description: 高效读取项目文档，支持智能定位和精准提取，减少token消耗。支持 @docs/ 引用语法
version: 1.1.0
---

# 项目文档阅读器

高效读取《星穹铁道剧情复现计划》项目文档的专用工具。支持 `@docs/` 引用语法快速定位文档。

## 功能

1. **智能定位** - 根据关键词快速定位文档章节
2. **精准提取** - 只读取需要的部分，避免全文读取
3. **结构化查询** - 支持按文档类型、模块、阶段查询
4. **缓存优化** - 记住已读内容，避免重复读取

## 文档结构

```
docs/
├── 需求文档-星穹铁道剧情复现计划.md
├── 概要设计.md
├── WBS任务分解表.md
├── Phase1-开发落地方案.md
├── 项目进度表.md
├── 优化计划.md
├── QA-P1-01-测试用例设计.md
├── Phase1-测试完成总结.md
└── modules/
    ├── DEV-P1-01-基础设施与数据模型.md
    ├── DEV-P1-02-视野与信息.md
    ├── DEV-P1-03-人物状态演化.md
    ├── DEV-P1-04-输入解析.md
    ├── DEV-P1-05-角色Agent.md
    ├── DEV-P1-06-剧情编排.md
    ├── DEV-P1-07-导出导入.md
    ├── DEV-P1-08-锚点与对比.md
    └── DEV-P1-09-表现层UI.md
```

## 使用方法

### 1. 使用 @docs/ 引用（推荐）

当用户使用 `@docs/` 引用文档时，优先使用 grep 精准定位：

```bash
# 用户: @docs/Phase1-开发落地方案.md 的验收标准是什么？
# 执行: grep -A 20 "验收标准" docs/Phase1-开发落地方案.md | head -30

# 用户: @docs/modules/DEV-P1-01-基础设施与数据模型.md 的API接口
# 执行: grep -A 50 "## 三、API 接口" docs/modules/DEV-P1-01-基础设施与数据模型.md
```

### 2. 查询验收标准

```bash
# 查询Phase 1验收标准
grep -A 20 "验收标准" docs/Phase1-开发落地方案.md | head -30
```

### 3. 查询模块信息

```bash
# 查询特定模块的API接口
grep -A 50 "## 三、API 接口" docs/modules/DEV-P1-01-基础设施与数据模型.md
```

### 4. 查询测试状态

```bash
# 查询测试统计
grep -A 10 "测试统计" docs/Phase1-测试完成总结.md
```

### 5. 查询WBS任务

```bash
# 查询特定任务的详细信息
grep -A 15 "P1-INF-01" docs/WBS任务分解表.md
```

## 快速查询命令

### @docs/ 引用处理策略

当遇到 `@docs/文件名` 引用时：

1. **先查缓存** - 检查下方的"文档摘要缓存"是否有答案
2. **再用 grep** - 使用关键词精准定位章节
3. **最后读取** - 只在必要时读取完整文档

### 常用查询模板

```bash
# 查询文档章节
grep -A <行数> "<章节标题>" docs/<文件名> | head -<限制行数>

# 查询关键词上下文
grep -B 5 -A 10 "<关键词>" docs/<文件名>

# 查询表格内容
grep -A 20 "| " docs/<文件名> | head -30

# 统计信息
grep -c "<关键词>" docs/<文件名>
```

### 预定义查询

**查询验收标准**

```bash
grep -E "验收标准|验收项" docs/Phase1-开发落地方案.md | head -20
```

**查询模块状态**

```bash
ls docs/modules/ | wc -l  # 统计已完成模块数
```

**查询测试覆盖率**

```bash
grep -A 5 "覆盖率" docs/Phase1-测试完成总结.md | head -15
```

**查询下一步工作**

```bash
grep -A 10 "下一步" docs/项目进度表.md
```

**查询特定模块的功能清单**

```bash
grep -A 30 "## 二、功能清单" docs/modules/DEV-P1-<模块编号>-<模块名称>.md
```

## 文档摘要缓存

### 核心文档快速索引

| 文档                   | 关键章节 | 快速查询命令                                        |
| ---------------------- | -------- | --------------------------------------------------- |
| Phase1-开发落地方案.md | 验收标准 | `grep -A 20 "验收标准" docs/Phase1-开发落地方案.md` |
| Phase1-测试完成总结.md | 测试统计 | `grep -A 10 "测试统计" docs/Phase1-测试完成总结.md` |
| WBS任务分解表.md       | 任务列表 | `grep "P1-" docs/WBS任务分解表.md`                  |
| 项目进度表.md          | 当前阶段 | `grep -A 10 "当前" docs/项目进度表.md`              |
| 概要设计.md            | 系统架构 | `grep -A 30 "架构" docs/概要设计.md`                |

### Phase 1 关键信息（缓存）

**验收标准**（5项）：

1. ✅ 视野隔离验证 - 1场景+2角色，信息正确隔离
2. ✅ 剧情推进可控 - 指令型/对话型输入正确解析
3. ✅ 导出/导入可用 - JSON导出包可成功导入
4. ✅ 对比结果可见 - 单节点对比输出差异说明
5. ✅ 状态演化可配置 - 触发表配置生效

**测试状态**：

- 总测试：227个
- 通过：227个（100%）
- 失败：0个
- Core包覆盖率：82.75%（超标）
- Infrastructure包覆盖率：46.70%（部分模块未测试）

**已完成模块**（9个）：

- DEV-P1-01 基础设施与数据模型 ✅
- DEV-P1-02 视野与信息 ✅
- DEV-P1-03 人物状态演化 ✅
- DEV-P1-04 输入解析 ✅
- DEV-P1-05 角色Agent ✅
- DEV-P1-06 剧情编排 ✅
- DEV-P1-07 导出导入 ✅
- DEV-P1-08 锚点与对比 ✅
- DEV-P1-09 表现层UI ✅

**当前阶段**：Phase 1 MVP 开发完成，准备进入测试和发布阶段

**下一步工作**：

1. QA-P1-02 功能测试 + 回归（W5）
2. QA-P1-03 发布准备（W5）
3. REL-P1-01 内测/灰度发布（W5）

### 模块文档索引

| 模块ID    | 模块名称           | 文档路径                                     | 关键章节          |
| --------- | ------------------ | -------------------------------------------- | ----------------- |
| DEV-P1-01 | 基础设施与数据模型 | docs/modules/DEV-P1-01-基础设施与数据模型.md | API接口、配置文件 |
| DEV-P1-02 | 视野与信息         | docs/modules/DEV-P1-02-视野与信息.md         | 视野过滤规则      |
| DEV-P1-03 | 人物状态演化       | docs/modules/DEV-P1-03-人物状态演化.md       | 触发表配置        |
| DEV-P1-04 | 输入解析           | docs/modules/DEV-P1-04-输入解析.md           | 解析规则          |
| DEV-P1-05 | 角色Agent          | docs/modules/DEV-P1-05-角色Agent.md          | Prompt构建        |
| DEV-P1-06 | 剧情编排           | docs/modules/DEV-P1-06-剧情编排.md           | 编排流程          |
| DEV-P1-07 | 导出导入           | docs/modules/DEV-P1-07-导出导入.md           | 导出格式          |
| DEV-P1-08 | 锚点与对比         | docs/modules/DEV-P1-08-锚点与对比.md         | 对比算法          |
| DEV-P1-09 | 表现层UI           | docs/modules/DEV-P1-09-表现层UI.md           | UI组件            |

## 最佳实践

### 处理 @docs/ 引用的流程

1. **识别引用** - 用户提到 `@docs/文件名`
2. **提取关键词** - 从用户问题中提取查询关键词
3. **查缓存** - 先检查"文档摘要缓存"是否有答案
4. **精准定位** - 使用 grep 定位到具体章节
5. **限制输出** - 使用 head/tail 限制行数（通常 20-50 行）

### 示例对话

**用户**: `@docs/Phase1-开发落地方案.md` 的验收标准是什么？

**处理**:

```bash
# 1. 识别文件：Phase1-开发落地方案.md
# 2. 关键词：验收标准
# 3. 查缓存：发现缓存中有验收标准信息
# 4. 直接返回缓存内容，无需读取文件
```

**用户**: `@docs/modules/DEV-P1-01-基础设施与数据模型.md` 的配置文件在哪？

**处理**:

```bash
# 1. 识别文件：docs/modules/DEV-P1-01-基础设施与数据模型.md
# 2. 关键词：配置文件
# 3. 查缓存：缓存中没有详细配置路径
# 4. 使用 grep 精准定位
grep -A 20 "## 四、配置文件" docs/modules/DEV-P1-01-基础设施与数据模型.md
```

### Token 优化技巧

1. **优先使用缓存** - 80% 的常见问题可以从缓存回答
2. **grep 精准定位** - 只读取相关章节，不读全文
3. **限制输出行数** - 使用 head/tail 控制在 50 行以内
4. **组合查询** - 使用管道组合多个命令
5. **避免重复读取** - 记住已读内容，引用时直接说明

### 查询优化示例

❌ **低效方式**（消耗大量 token）：

```bash
# 读取整个文档
cat docs/Phase1-开发落地方案.md
```

✅ **高效方式**（节省 90% token）：

```bash
# 只读取验收标准章节
grep -A 20 "验收标准" docs/Phase1-开发落地方案.md | head -30
```

## 示例

### 查询某个模块的功能清单

```bash
grep -A 30 "## 二、功能清单" docs/modules/DEV-P1-01-基础设施与数据模型.md
```

### 查询测试失败原因

```bash
grep -B 5 -A 10 "失败" docs/QA-P1-01-测试用例设计.md
```

### 查询配置文件位置

```bash
grep -A 20 "## 四、配置文件" docs/modules/DEV-P1-01-基础设施与数据模型.md
```

## 注意事项

- 文档使用中文编写
- 使用 Markdown 格式
- 包含大量表格和代码示例
- 文档间有交叉引用
- 定期更新变更记录

## 更新日志

- v1.1.0 (2026-02-18) - 添加 @docs/ 引用支持，优化缓存策略，增加模块文档索引
- v1.0.0 (2026-02-17) - 初始版本，基础文档查询功能
