# æ˜Ÿç©¹é“é“å‰§æƒ…å¤ç°è®¡åˆ’

åŸºäº LLM çš„å‰§æƒ…æ¨¡æ‹Ÿç³»ç»Ÿï¼Œç”¨äºå¤ç°å’Œæ¢ç´¢ã€Šå´©åï¼šæ˜Ÿç©¹é“é“ã€‹çš„å‰§æƒ…åˆ†æ”¯ã€‚

## Monorepo å·¥ç¨‹ä»‹ç»

æœ¬é¡¹ç›®é‡‡ç”¨ **pnpm workspace** ç®¡ç†çš„ Monorepo æ¶æ„ï¼Œå°†ä»£ç æŒ‰èŒè´£åˆ†å±‚ç»„ç»‡ä¸ºå¤šä¸ªç‹¬ç«‹åŒ…ï¼Œä¾¿äºæ¨¡å—åŒ–å¼€å‘ã€æµ‹è¯•å’Œç»´æŠ¤ã€‚

### ä¸ºä»€ä¹ˆé€‰æ‹© Monorepo

- **ä»£ç å…±äº«**ï¼šå…±äº«ç±»å‹å®šä¹‰å’Œå·¥å…·å‡½æ•°ï¼Œé¿å…é‡å¤ä»£ç 
- **ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†**ï¼šæ‰€æœ‰åŒ…ä½¿ç”¨ç»Ÿä¸€çš„ä¾èµ–ç‰ˆæœ¬ï¼Œå‡å°‘å…¼å®¹æ€§é—®é¢˜
- **åŸå­æäº¤**ï¼šè·¨åŒ…ä¿®æ”¹å¯ä»¥åœ¨å•æ¬¡æäº¤ä¸­å®Œæˆ
- **ç®€åŒ–ä¾èµ–**ï¼šworkspace åè®® (`workspace:*`) è‡ªåŠ¨é“¾æ¥æœ¬åœ°åŒ…

---

## é¡¹ç›®ç»“æ„

```
StarRailReplicationPlan/
â”œâ”€â”€ packages/                    # æºç åŒ…ç›®å½•
â”‚   â”œâ”€â”€ types/                   # å…±äº«ç±»å‹å®šä¹‰å±‚
â”‚   â”œâ”€â”€ infrastructure/          # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒé¢†åŸŸå±‚
â”‚   â””â”€â”€ cli/                     # CLI è¡¨ç°å±‚
â”‚
â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ characters/              # äººç‰©é…ç½®ï¼ˆYAMLï¼‰
â”‚   â”œâ”€â”€ scenes/                  # åœºæ™¯é…ç½®ï¼ˆYAMLï¼‰
â”‚   â”œâ”€â”€ triggers/                # è§¦å‘è¡¨é…ç½®ï¼ˆYAMLï¼‰
â”‚   â””â”€â”€ llm.yaml                 # LLM Provider é…ç½®
â”‚
â”œâ”€â”€ data/                        # è¿è¡Œæ—¶æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ sessions/                # ä¼šè¯å­˜æ¡£
â”‚   â””â”€â”€ anchors/                 # é”šç‚¹æ•°æ®
â”‚
â”œâ”€â”€ exports/                     # å¯¼å‡ºåŒ…å­˜å‚¨ç›®å½•
â”œâ”€â”€ logs/                        # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docs/                        # é¡¹ç›®æ–‡æ¡£
â”‚
â”œâ”€â”€ package.json                 # æ ¹é…ç½®æ–‡ä»¶
â”œâ”€â”€ pnpm-workspace.yaml          # pnpm workspace é…ç½®
â”œâ”€â”€ tsconfig.json                # TypeScript æ ¹é…ç½®
â”œâ”€â”€ .eslintrc.cjs                # ESLint é…ç½®
â”œâ”€â”€ .prettierrc                  # Prettier é…ç½®
â”œâ”€â”€ commitlint.config.cjs        # Commit è§„èŒƒé…ç½®
â”œâ”€â”€ .husky/                      # Git Hooks
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ .gitignore                   # Git å¿½ç•¥è§„åˆ™
```

---

## åŒ…ç»“æ„è¯¦è§£

### packages/types - å…±äº«ç±»å‹å®šä¹‰å±‚

å®šä¹‰æ‰€æœ‰æ ¸å¿ƒæ•°æ®ç»“æ„çš„ Zod Schema å’Œ TypeScript ç±»å‹ã€‚

```
packages/types/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ character.ts       # äººç‰©ç›¸å…³ Schemaï¼ˆCharacter/Relationship/BigFiveTraitsï¼‰
â”‚   â”œâ”€â”€ world-state.ts     # ä¸–ç•ŒçŠ¶æ€ Schemaï¼ˆWorldState/Environment/EventRecordï¼‰
â”‚   â”œâ”€â”€ information.ts     # ä¿¡æ¯ Schemaï¼ˆInformation/InformationStoreï¼‰
â”‚   â”œâ”€â”€ session.ts         # ä¼šè¯ Schemaï¼ˆSessionState/Snapshotï¼‰
â”‚   â”œâ”€â”€ anchor.ts          # é”šç‚¹ Schemaï¼ˆAnchor/ComparisonResultï¼‰
â”‚   â”œâ”€â”€ config.ts          # é…ç½® Schemaï¼ˆLLMConfig/TriggerRule/CharacterConfigï¼‰
â”‚   â””â”€â”€ index.ts           # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**æ ¸å¿ƒç±»å‹è¯´æ˜**ï¼š

| ç±»å‹            | è¯´æ˜                                               |
| --------------- | -------------------------------------------------- |
| `Character`     | äººç‰©å®ä½“ï¼ŒåŒ…å«åŸºç¡€ä¿¡æ¯ã€çŠ¶æ€ã€äººæ ¼æ¨¡å‹             |
| `Relationship`  | å¤šç»´åº¦å…³ç³»ï¼ˆä¿¡ä»»/æ•Œå¯¹/äº²å¯†/å°Šé‡ï¼‰                  |
| `BigFiveTraits` | äº”å¤§äººæ ¼ç‰¹è´¨ï¼ˆå¼€æ”¾æ€§/å°½è´£æ€§/å¤–å‘æ€§/å®œäººæ€§/ç¥ç»è´¨ï¼‰ |
| `WorldState`    | ä¸–ç•ŒçŠ¶æ€ï¼ŒåŒ…å«åœºæ™¯ã€æ—¶é—´çº¿ã€ç¯å¢ƒã€äº‹ä»¶é“¾           |
| `Information`   | ä¿¡æ¯å®ä½“ï¼Œæ”¯æŒè§†é‡éš”ç¦»                             |
| `SessionState`  | ä¼šè¯å®Œæ•´çŠ¶æ€ï¼Œå•æ–‡ä»¶å­˜å‚¨                           |
| `Anchor`        | å‰§æƒ…é”šç‚¹ï¼Œç”¨äºå¯¹æ¯”è¯„ä¼°                             |

---

### packages/infrastructure - åŸºç¡€è®¾æ–½å±‚

æä¾›å­˜å‚¨ã€é…ç½®åŠ è½½ã€LLM è°ƒç”¨ã€æ—¥å¿—ç­‰åŸºç¡€èƒ½åŠ›ã€‚

```
packages/infrastructure/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ storage.interface.ts    # å­˜å‚¨æ¥å£å®šä¹‰
â”‚   â”‚   â””â”€â”€ json-file-storage.ts    # JSON æ–‡ä»¶å­˜å‚¨å®ç°
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ config-loader.ts        # YAML/JSON é…ç½®åŠ è½½å™¨
â”‚   â”‚   â””â”€â”€ env-loader.ts           # ç¯å¢ƒå˜é‡åŠ è½½å™¨
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”œâ”€â”€ llm-provider.interface.ts  # LLM Provider æ¥å£
â”‚   â”‚   â”œâ”€â”€ llm-provider.factory.ts    # Provider å·¥å‚
â”‚   â”‚   â””â”€â”€ providers/
â”‚   â”‚       â”œâ”€â”€ deepseek.provider.ts   # Deepseek å®ç°
â”‚   â”‚       â””â”€â”€ claude.provider.ts     # Claude å®ç°
â”‚   â”œâ”€â”€ error/
â”‚   â”‚   â””â”€â”€ app-error.ts            # ç»Ÿä¸€é”™è¯¯ç±»
â”‚   â”œâ”€â”€ logging/
â”‚   â”‚   â””â”€â”€ logger.ts               # Winston æ—¥å¿—å°è£…
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**æ¨¡å—è¯´æ˜**ï¼š

| æ¨¡å—                 | åŠŸèƒ½                                  |
| -------------------- | ------------------------------------- |
| `JsonFileStorage`    | ä¼šè¯çŠ¶æ€å’Œå¿«ç…§çš„ JSON æ–‡ä»¶å­˜å‚¨        |
| `ConfigLoader`       | åŠ è½½ YAML/JSON é…ç½®å¹¶é€šè¿‡ Zod æ ¡éªŒ    |
| `EnvLoader`          | ä» .env æ–‡ä»¶åŠ è½½æ•æ„Ÿé…ç½®ï¼ˆAPI Keyï¼‰   |
| `LLMProviderFactory` | ç®¡ç†å¤šä¸ª LLM Providerï¼Œæ”¯æŒæŒ‰è§’è‰²åˆ†é… |
| `DeepseekProvider`   | Deepseek API è°ƒç”¨å®ç°                 |
| `ClaudeProvider`     | Anthropic Claude API è°ƒç”¨å®ç°         |
| `Logger`             | åŸºäº Winston çš„æ—¥å¿—ç®¡ç†               |

---

### packages/core - æ ¸å¿ƒé¢†åŸŸå±‚

å®ç° 8 å¤§æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ã€‚

```
packages/core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ character-agent/           # è§’è‰² Agent æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ character-agent.ts     # LLM é©±åŠ¨çš„è§’è‰²å“åº”ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ prompt-builder.ts      # Prompt æ„å»ºå™¨
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ character-state/           # äººç‰©çŠ¶æ€æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ behavior-engine.ts     # è¡Œä¸ºå¼•æ“ï¼ˆäººæ ¼â†’è¡Œä¸ºå€¾å‘æ¨å¯¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ character-state.service.ts  # çŠ¶æ€ç®¡ç†æœåŠ¡
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ vision-manager/            # è§†é‡ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ vision-manager.ts      # ä¿¡æ¯è§†é‡è¿‡æ»¤
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ world-engine/              # ä¸–ç•Œå¼•æ“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ world-engine.ts        # ä¸–ç•ŒçŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ input-parser/              # è¾“å…¥è§£ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ input-parser.ts        # ç”¨æˆ·è¾“å…¥åˆ†ç±»è§£æ
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ story-orchestrator/        # å‰§æƒ…ç¼–æ’æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ story-orchestrator.ts  # ä¸²è”å„æ¨¡å—çš„ä¸»æµç¨‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ anchor-evaluation/         # é”šç‚¹è¯„ä¼°æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ anchor-evaluator.ts    # åˆ†æ”¯å¯¹æ¯”è¯„ä¼°
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ export-import/             # å¯¼å‡ºå¯¼å…¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ export-import.service.ts  # äººç‰©/åœºæ™¯å¯¼å‡ºå¯¼å…¥
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ container.ts               # DI å®¹å™¨é…ç½®
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**æ¨¡å—è¯´æ˜**ï¼š

| æ¨¡å—                  | åŠŸèƒ½                              |
| --------------------- | --------------------------------- |
| `CharacterAgent`      | è°ƒç”¨ LLM ç”Ÿæˆè§’è‰²å¯¹è¯å’Œè¡ŒåŠ¨       |
| `PromptBuilder`       | æ„å»ºè§’è‰²å“åº”çš„ System/User Prompt |
| `BehaviorEngine`      | ä»äº”å¤§äººæ ¼æ¨å¯¼è¡Œä¸ºå€¾å‘            |
| `TriggerEngine`       | æ‰§è¡Œè§¦å‘è¡¨è§„åˆ™ï¼Œæ›´æ–°äººç‰©çŠ¶æ€      |
| `VisionManager`       | ç®¡ç†ä¿¡æ¯è§†é‡ï¼Œå®ç°è§†é‡éš”ç¦»        |
| `WorldEngine`         | ç®¡ç†ä¸–ç•ŒçŠ¶æ€ã€åœºæ™¯åˆ‡æ¢ã€äº‹ä»¶é“¾    |
| `InputParser`         | è§£æç”¨æˆ·è¾“å…¥ä¸ºæŒ‡ä»¤å‹/å¯¹è¯å‹       |
| `StoryOrchestrator`   | å‰§æƒ…æ¨è¿›ä¸»æµç¨‹ç¼–æ’                |
| `AnchorEvaluator`     | å¯¹æ¯”å½“å‰åˆ†æ”¯ä¸åŸå‰§æƒ…é”šç‚¹          |
| `ExportImportService` | äººç‰©/åœºæ™¯é…ç½®çš„å¯¼å‡ºå¯¼å…¥           |

---

### packages/cli - CLI è¡¨ç°å±‚

å‘½ä»¤è¡Œäº¤äº’ç•Œé¢ï¼Œæä¾›ç”¨æˆ·ä¸ç³»ç»Ÿäº¤äº’çš„å…¥å£ã€‚

```
packages/cli/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ commands/                  # å‘½ä»¤å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ start.ts               # å¯åŠ¨ä¼šè¯å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ session.ts             # ä¼šè¯ç®¡ç†å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ export.ts              # å¯¼å‡ºå‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ import.ts              # å¯¼å…¥å‘½ä»¤
â”‚   â”‚   â””â”€â”€ config.ts              # é…ç½®ç®¡ç†å‘½ä»¤
â”‚   â”œâ”€â”€ ui/                        # äº¤äº’ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ main-menu.ts           # ä¸»èœå•
â”‚   â”‚   â””â”€â”€ session-workspace.ts   # ä¼šè¯å·¥ä½œåŒº
â”‚   â”œâ”€â”€ services/                  # æœåŠ¡å°è£…
â”‚   â”‚   â”œâ”€â”€ session-manager.ts     # ä¼šè¯ç®¡ç†æœåŠ¡
â”‚   â”‚   â””â”€â”€ export-service.ts      # å¯¼å‡ºæœåŠ¡
â”‚   â””â”€â”€ index.ts                   # CLI å…¥å£
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**CLI å‘½ä»¤è¯´æ˜**ï¼š

| å‘½ä»¤                              | è¯´æ˜                     |
| --------------------------------- | ------------------------ |
| `star-rail`                       | æ˜¾ç¤ºäº¤äº’å¼ä¸»èœå•         |
| `star-rail start`                 | å¯åŠ¨æ–°ä¼šè¯æˆ–ç»§ç»­ç°æœ‰ä¼šè¯ |
| `star-rail start -n`              | ç›´æ¥åˆ›å»ºæ–°ä¼šè¯           |
| `star-rail start -c <id>`         | ç»§ç»­æŒ‡å®šä¼šè¯             |
| `star-rail session list`          | åˆ—å‡ºæ‰€æœ‰ä¼šè¯             |
| `star-rail session info <id>`     | æŸ¥çœ‹ä¼šè¯è¯¦æƒ…             |
| `star-rail session delete <id>`   | åˆ é™¤ä¼šè¯                 |
| `star-rail session snapshot <id>` | åˆ›å»ºå¿«ç…§                 |
| `star-rail export [type] [id]`    | å¯¼å‡ºäººç‰©/åœºæ™¯é…ç½®        |
| `star-rail import [file]`         | å¯¼å…¥é…ç½®æ–‡ä»¶             |
| `star-rail config show`           | æ˜¾ç¤ºå½“å‰é…ç½®             |
| `star-rail config check`          | éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®         |
| `star-rail config init`           | åˆå§‹åŒ–é…ç½®ç›®å½•           |

**ä¼šè¯å·¥ä½œåŒºå‘½ä»¤**ï¼š

è¿›å…¥ä¼šè¯åï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

| å‘½ä»¤               | è¯´æ˜         |
| ------------------ | ------------ |
| `/help`            | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `/status`          | æ˜¾ç¤ºå½“å‰çŠ¶æ€ |
| `/characters`      | æ˜¾ç¤ºäººç‰©åˆ—è¡¨ |
| `/events`          | æ˜¾ç¤ºæœ€è¿‘äº‹ä»¶ |
| `/save`            | ä¿å­˜ä¼šè¯     |
| `/snapshot [æè¿°]` | åˆ›å»ºå¿«ç…§     |
| `/quit`            | é€€å‡ºä¼šè¯     |

**å‰§æƒ…è¾“å…¥æ ¼å¼**ï¼š

| æ ¼å¼   | ç¤ºä¾‹               |
| ------ | ------------------ |
| å¯¹è¯å‹ | `å¯¹ä¸‰æœˆä¸ƒè¯´ï¼šä½ å¥½` |
| æŒ‡ä»¤å‹ | `è®©ä¸‰æœˆä¸ƒå»è°ƒæŸ¥`   |

---

## ä¾èµ–é…ç½®è¯´æ˜

### æ ¹ç›®å½• devDependencies

| ä¾èµ–                               | ç‰ˆæœ¬     | åŠŸèƒ½                       |
| ---------------------------------- | -------- | -------------------------- |
| `typescript`                       | ^5.3.3   | TypeScript ç¼–è¯‘å™¨          |
| `@types/node`                      | ^20.10.6 | Node.js ç±»å‹å®šä¹‰           |
| `tsup`                             | ^8.0.1   | å¿«é€Ÿ TypeScript æ‰“åŒ…å·¥å…·   |
| `eslint`                           | ^8.56.0  | ä»£ç é™æ€æ£€æŸ¥               |
| `@typescript-eslint/parser`        | ^6.17.0  | ESLint TypeScript è§£æå™¨   |
| `@typescript-eslint/eslint-plugin` | ^6.17.0  | ESLint TypeScript è§„åˆ™     |
| `eslint-config-prettier`           | ^9.1.0   | ESLint + Prettier å…¼å®¹é…ç½® |
| `prettier`                         | ^3.1.1   | ä»£ç æ ¼å¼åŒ–                 |
| `husky`                            | ^8.0.3   | Git Hooks ç®¡ç†             |
| `lint-staged`                      | ^15.2.0  | æš‚å­˜æ–‡ä»¶ lint              |
| `@commitlint/cli`                  | ^18.4.4  | Commit æ¶ˆæ¯æ£€æŸ¥            |
| `@commitlint/config-conventional`  | ^18.4.4  | Conventional Commits è§„èŒƒ  |

### packages/types dependencies

| ä¾èµ–  | ç‰ˆæœ¬    | åŠŸèƒ½                      |
| ----- | ------- | ------------------------- |
| `zod` | ^3.22.4 | è¿è¡Œæ—¶æ•°æ®æ ¡éªŒ + ç±»å‹æ¨å¯¼ |

### packages/infrastructure dependencies

| ä¾èµ–                | ç‰ˆæœ¬    | åŠŸèƒ½                        |
| ------------------- | ------- | --------------------------- |
| `zod`               | ^3.22.4 | é…ç½®æ ¡éªŒ                    |
| `tsyringe`          | ^4.8.0  | ä¾èµ–æ³¨å…¥å®¹å™¨                |
| `reflect-metadata`  | ^0.2.1  | è£…é¥°å™¨å…ƒæ•°æ®æ”¯æŒ            |
| `dotenv`            | ^16.3.1 | ç¯å¢ƒå˜é‡åŠ è½½                |
| `js-yaml`           | ^4.1.0  | YAML è§£æ                   |
| `winston`           | ^3.11.0 | æ—¥å¿—ç®¡ç†                    |
| `fs-extra`          | ^11.2.0 | å¢å¼ºçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ          |
| `@anthropic-ai/sdk` | ^0.17.1 | Claude API SDK              |
| `openai`            | ^4.24.1 | OpenAI å…¼å®¹ APIï¼ˆDeepseekï¼‰ |

### packages/core dependencies

| ä¾èµ–                        | ç‰ˆæœ¬         | åŠŸèƒ½         |
| --------------------------- | ------------ | ------------ |
| `@star-rail/types`          | workspace:\* | å…±äº«ç±»å‹å®šä¹‰ |
| `@star-rail/infrastructure` | workspace:\* | åŸºç¡€è®¾æ–½å±‚   |
| `tsyringe`                  | ^4.8.0       | ä¾èµ–æ³¨å…¥     |
| `reflect-metadata`          | ^0.2.1       | è£…é¥°å™¨æ”¯æŒ   |
| `fs-extra`                  | ^11.2.0      | æ–‡ä»¶æ“ä½œ     |

### packages/cli dependencies

| ä¾èµ–                        | ç‰ˆæœ¬         | åŠŸèƒ½           |
| --------------------------- | ------------ | -------------- |
| `@star-rail/types`          | workspace:\* | å…±äº«ç±»å‹å®šä¹‰   |
| `@star-rail/infrastructure` | workspace:\* | åŸºç¡€è®¾æ–½å±‚     |
| `@star-rail/core`           | workspace:\* | æ ¸å¿ƒé¢†åŸŸå±‚     |
| `commander`                 | ^11.1.0      | å‘½ä»¤è¡Œå‚æ•°è§£æ |
| `inquirer`                  | ^9.2.12      | äº¤äº’å¼å‘½ä»¤è¡Œ   |
| `chalk`                     | ^5.3.0       | ç»ˆç«¯é¢œè‰²è¾“å‡º   |
| `ora`                       | ^7.0.1       | ç»ˆç«¯åŠ è½½åŠ¨ç”»   |
| `cli-table3`                | ^0.6.3       | ç»ˆç«¯è¡¨æ ¼è¾“å‡º   |
| `boxen`                     | ^7.1.1       | ç»ˆç«¯è¾¹æ¡†ç›’å­   |
| `reflect-metadata`          | ^0.2.1       | è£…é¥°å™¨æ”¯æŒ     |

---

## é…ç½®æ–‡ä»¶è¯´æ˜

### config/llm.yaml - LLM é…ç½®

```yaml
defaultProvider: deepseek # é»˜è®¤ä½¿ç”¨çš„ Provider

providers:
  deepseek:
    enabled: true
    model: deepseek-chat
    baseUrl: https://api.deepseek.com/v1
    defaultParams:
      temperature: 0.7
      maxTokens: 2000

  claude:
    enabled: true
    model: claude-sonnet-4-5-20250929
    defaultParams:
      temperature: 0.7
      maxTokens: 2000

characterProviders: # è§’è‰²ä¸“ç”¨ Providerï¼ˆå¯é€‰ï¼‰
  # march7: deepseek
  # stelle: claude
```

### config/characters/\*.yaml - äººç‰©é…ç½®

å®šä¹‰äººç‰©çš„åŸºç¡€ä¿¡æ¯ã€äººæ ¼ç‰¹è´¨ã€åˆå§‹å…³ç³»ç­‰ã€‚

### config/scenes/\*.yaml - åœºæ™¯é…ç½®

å®šä¹‰åœºæ™¯çš„ç¯å¢ƒã€è¿æ¥å…³ç³»ç­‰ã€‚

### config/triggers/\*.yaml - è§¦å‘è¡¨é…ç½®

å®šä¹‰äº‹ä»¶è§¦å‘çš„çŠ¶æ€å˜åŒ–è§„åˆ™ã€‚

### .env - ç¯å¢ƒå˜é‡

```bash
# LLM API Keysï¼ˆæ•æ„Ÿä¿¡æ¯ï¼Œä¸æäº¤åˆ° Gitï¼‰
DEEPSEEK_API_KEY=sk-xxxxx
ANTHROPIC_API_KEY=sk-ant-xxxxx

# åº”ç”¨é…ç½®
NODE_ENV=development
LOG_LEVEL=info
```

---

## å¿«é€Ÿå¼€å§‹

### ğŸš€ ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. é…ç½® API Key
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½® DEEPSEEK_API_KEY

# 3. ä¸€é”®å¯åŠ¨ï¼ˆè‡ªåŠ¨æ„å»ºã€åˆ›å»ºç¤ºä¾‹ä¼šè¯ã€å¯åŠ¨æ¸¸æˆï¼‰
./scripts/quick-start.sh
```

### ğŸ“– è¯¦ç»†æŒ‡å—

æŸ¥çœ‹ [å¿«é€Ÿå¼€å§‹æŒ‡å—](docs/å¿«é€Ÿå¼€å§‹æŒ‡å—.md) äº†è§£ï¼š

- ç¯å¢ƒé…ç½®è¯¦ç»†æ­¥éª¤
- ç¤ºä¾‹ä¼šè¯åˆ›å»º
- äº’åŠ¨å‘½ä»¤ä½¿ç”¨
- æ ¸å¿ƒåŠŸèƒ½ä½“éªŒ
- å¸¸è§é—®é¢˜è§£ç­”

### ç¯å¢ƒè¦æ±‚

- Node.js >= 20.0.0
- pnpm >= 8.0.0
- DeepSeek API Keyï¼ˆæˆ–å…¶ä»–å…¼å®¹ OpenAI çš„ LLM APIï¼‰

### æ‰‹åŠ¨å®‰è£…

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºæ‰€æœ‰åŒ…
pnpm build

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ DEEPSEEK_API_KEY

# åˆ›å»ºç¤ºä¾‹ä¼šè¯
pnpm demo

# å¯åŠ¨æ¸¸æˆ
pnpm start
```

### è¿è¡Œ

**CLI ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œæ— è®ºä»å“ªé‡Œè¿è¡Œéƒ½èƒ½æ­£ç¡®è®¿é—®é…ç½®å’Œæ•°æ®ã€‚**

```bash
# æ–¹å¼1ï¼šä½¿ç”¨ pnpm è„šæœ¬ï¼ˆæ¨èï¼‰
pnpm start                    # å¯åŠ¨äº¤äº’å¼èœå•
pnpm cli session list         # åˆ—å‡ºæ‰€æœ‰ä¼šè¯
pnpm cli config check         # æ£€æŸ¥é…ç½®

# æ–¹å¼2ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬
./start-cli.sh                # å¯åŠ¨äº¤äº’å¼èœå•
./start-cli.sh session list   # åˆ—å‡ºæ‰€æœ‰ä¼šè¯

# æ–¹å¼3ï¼šç›´æ¥è¿è¡Œï¼ˆå¯ä»¥ä»ä»»ä½•ç›®å½•ï¼‰
node packages/cli/dist/index.js              # å¯åŠ¨äº¤äº’å¼èœå•
node packages/cli/dist/index.js start --new  # åˆ›å»ºæ–°ä¼šè¯
```

**è·¯å¾„å¤„ç†æœºåˆ¶ï¼š**

- CLI å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æŸ¥æ‰¾é¡¹ç›®æ ¹ç›®å½•ï¼ˆåŒ…å« `workspaces` å­—æ®µçš„ package.jsonï¼‰
- è‡ªåŠ¨åˆ‡æ¢å·¥ä½œç›®å½•åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œç¡®ä¿ç›¸å¯¹è·¯å¾„æ­£ç¡®
- æ‰€æœ‰æ•°æ®æ–‡ä»¶ï¼ˆä¼šè¯ã€é”šç‚¹ï¼‰éƒ½å­˜å‚¨åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `data/` ç›®å½•ä¸‹
- é…ç½®æ–‡ä»¶ä»é¡¹ç›®æ ¹ç›®å½•çš„ `config/` ç›®å½•åŠ è½½
- `.env` æ–‡ä»¶ä»é¡¹ç›®æ ¹ç›®å½•åŠ è½½

**æ³¨æ„äº‹é¡¹ï¼š**

- ç¡®ä¿å·²ç»è¿è¡Œ `pnpm build` æ„å»ºæ‰€æœ‰åŒ…
- ç¡®ä¿ `.env` æ–‡ä»¶å·²é…ç½®ï¼ˆä» `.env.example` å¤åˆ¶å¹¶å¡«å†™ API Keyï¼‰

---

## å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºæ‰€æœ‰åŒ…
pnpm build

# ç›‘å¬æ¨¡å¼æ„å»º
pnpm dev

# ä»£ç æ£€æŸ¥
pnpm lint

# ä»£ç æ ¼å¼åŒ–
pnpm format

# è¿è¡Œæµ‹è¯•
pnpm test

# æ¸…ç†æ„å»ºäº§ç‰©
pnpm clean
```

---

## Git å·¥ä½œæµ

### åˆ†æ”¯ç­–ç•¥ï¼ˆGitHub Flowï¼‰

- `main`ï¼šä¸»åˆ†æ”¯ï¼Œå§‹ç»ˆå¯éƒ¨ç½²
- `feature/*`ï¼šåŠŸèƒ½åˆ†æ”¯
- `bugfix/*`ï¼šä¿®å¤åˆ†æ”¯
- `hotfix/*`ï¼šç´§æ€¥ä¿®å¤åˆ†æ”¯

### Commit è§„èŒƒï¼ˆConventional Commitsï¼‰

```
<type>(<scope>): <subject>

ç±»å‹ï¼š
- feat: æ–°åŠŸèƒ½
- fix: ä¿®å¤ bug
- docs: æ–‡æ¡£å˜æ›´
- style: ä»£ç æ ¼å¼
- refactor: é‡æ„
- test: æµ‹è¯•ç›¸å…³
- chore: æ„å»º/å·¥å…·å˜æ›´
```

---

## æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CLI è¡¨ç°å±‚                 â”‚  ç”¨æˆ·äº¤äº’
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Core æ ¸å¿ƒé¢†åŸŸå±‚            â”‚  ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Infrastructure åŸºç¡€è®¾æ–½å±‚      â”‚  æŠ€æœ¯å®ç°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Types ç±»å‹å®šä¹‰å±‚           â”‚  æ•°æ®ç»“æ„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ä¾èµ–å…³ç³»

```
InputParser â†’ StoryOrchestrator â†’ WorldEngine
                                â†’ VisionManager
                                â†’ CharacterStateService
                                â†’ CharacterAgent â†’ LLMProviderFactory
                                                 â†’ BehaviorEngine
                                                 â†’ PromptBuilder
```

---

## æ–‡æ¡£

- [éœ€æ±‚æ–‡æ¡£](docs/éœ€æ±‚æ–‡æ¡£-æ˜Ÿç©¹é“é“å‰§æƒ…å¤ç°è®¡åˆ’.md)
- [æ¦‚è¦è®¾è®¡](docs/æ¦‚è¦è®¾è®¡.md)
- [æŠ€æœ¯é€‰å‹ä¸æ¶æ„è®¾è®¡](docs/æŠ€æœ¯é€‰å‹ä¸æ¶æ„è®¾è®¡.md)
- [Phase1 å¼€å‘è½åœ°æ–¹æ¡ˆ](docs/Phase1-å¼€å‘è½åœ°æ–¹æ¡ˆ.md)
- [WBS ä»»åŠ¡åˆ†è§£è¡¨](docs/WBSä»»åŠ¡åˆ†è§£è¡¨.md)
- [é¡¹ç›®è¿›åº¦è¡¨](docs/é¡¹ç›®è¿›åº¦è¡¨.md)

---

## License

MIT
