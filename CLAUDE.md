# Claude Code 项目规则

本文件定义了 Claude Code 在本项目中的工作规则和约定。

## 一、模块完成文档规则

**规则**：每完成一个开发模块（DEV-P1-XX），必须在 `docs/modules/` 目录下创建对应的模块完成文档。

### 1.1 文档命名规范

```
docs/modules/{模块ID}-{模块名称}.md
```

示例：`docs/modules/DEV-P1-02-视野与信息.md`

### 1.2 文档结构模板

每个模块完成文档必须包含以下章节：

```markdown
# {模块ID} {模块名称}

## 一、模块概述

- 模块目标
- 对应 WBS 任务 ID
- 依赖模块
- 被依赖模块

## 二、功能清单

列出模块实现的所有功能点，包括：

- 功能名称
- 功能描述
- 对应的类/方法
- 文件位置

## 三、API 接口

列出模块对外暴露的接口：

- 接口签名
- 参数说明
- 返回值说明
- 使用示例

## 四、配置文件

列出模块相关的配置文件：

- 配置文件路径
- 配置项说明
- 配置示例

## 五、验收标准

对应 WBS 中的验收标准，逐条列出：

- [ ] 验收项 1
- [ ] 验收项 2
- ...

## 六、测试用例

列出关键测试用例：
| 测试用例 | 测试目的 | 预期结果 | 测试文件位置 |
|---------|---------|---------|-------------|

## 七、已知限制

列出当前实现的已知限制和后续优化方向

## 八、变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
| ---- | ---- | -------- | ------ |
```

### 1.3 执行时机

- 模块开发完成后
- 所有单元测试通过后
- 代码构建成功后

---

## 二、代码提交规则

### 2.1 Commit 规范

遵循 Conventional Commits 规范：

```
<type>(<scope>): <subject>

<body>

<footer>
```

**type 类型**：

- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档变更
- `style`: 代码格式
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 构建/工具变更

**scope 范围**：使用模块 ID，如 `DEV-P1-02`

### 2.2 提交前检查

- [ ] 代码通过 ESLint 检查
- [ ] 代码通过 Prettier 格式化
- [ ] 单元测试全部通过
- [ ] 构建成功

---

## 三、测试规则

### 3.1 测试文件位置

```
packages/{package}/src/{module}/__tests__/{module}.test.ts
```

### 3.2 测试覆盖率要求

- 分支覆盖率 ≥ 60%
- 函数覆盖率 ≥ 60%
- 行覆盖率 ≥ 60%

### 3.3 关键测试用例

每个模块必须包含以下类型的测试：

- 正常流程测试
- 边界条件测试
- 错误处理测试
- 视野隔离验证测试（如适用）

---

## 四、文档更新规则

### 4.1 需要更新的文档

完成模块开发后，检查并更新以下文档：

- `docs/modules/{模块ID}-{模块名称}.md` - 模块完成文档（必须）
- `docs/项目进度表.md` - 更新模块状态（如需要）
- `README.md` - 更新功能说明（如需要）

### 4.2 文档语言

- 代码注释：中文
- API 文档：中文
- 配置文件注释：中文

---

## 五、开发流程检查清单

每完成一个模块，执行以下检查：

```
□ 功能实现完成
□ 类型定义完整
□ 单元测试编写并通过
□ 代码构建成功
□ 模块完成文档编写
□ 相关配置文件创建
□ 导出接口更新
```
